'use strict';

// Dependencies
var BaseComponents = require('webapp/base');
var NuggetManagement = require('core/nugget_management');
var util = require('util');
var marked = require('marked');

// Constants
const NUM_NUGGETS_ON_HOME_PAGE = 5;

/**
 * Controller for managing the home page for users
 *
 * @author kvermeer
 */
function HomeController() {}
util.inherits(HomeController, BaseComponents.BaseController);

HomeController.prototype.getHomePage = function(request, response) {

    var userId = this.getCurrentUserId(request);
    var nuggetFinderService = new NuggetManagement.NuggetFinderService();
    nuggetFinderService.findRecentlyUpdatedNuggetsForUser(userId, NUM_NUGGETS_ON_HOME_PAGE).then(function(nuggetList) {
        nuggetList.forEach(function(nugget) {
            if (nugget.content !== null) {
                nugget.content = marked(nugget.content);
            } else {
                nugget.content = '';
            }

        });
        response.render('pages/user/home', { nuggetList: nuggetList });
    });
}

// Exports
module.exports = HomeController;
