/**
 * Service for creating users
 * @author kvermeer
 */

// Dependencies
var bcrypt = require('bcrypt');
var pg = require('pg');

var UserCreationService = function() {}

/**
 * @param {string} name - username for user
 * @param {string} email - email for user
 * @param {string} password - password for logging into user account
 * @param {function} callback - callback function to be called when query is issued.
 *                              function should take a boolean indicated success or failure
 * @return {object} -
 *      {
 *          'success' => true,
 *          'errors' => [],
 *      }
 */
UserCreationService.prototype.createUser = function(username, email, password, callback) {

    var passwordSalt = 10;
    var passwordHash = bcrypt.hashSync(password, passwordSalt);

    pg.connect(process.env.DATABASE_URL, function(err, client, done) {
        console.log(err);
        var queryStatement = 'INSERT INTO "user" (display_name, login, password_salt, password_hash) VALUES ($1, $2, $3, $4);';
        var values = [username, email, passwordSalt, passwordHash];
        client.query(queryStatement, values, function(err, result) {
             done();
             if (err) {
                 console.error(err);
                 callback(false);
             } else {
                 callback(true);
             }
         });
    });
}

module.exports = UserCreationService;
