/**
 * Service for creating users
 * @author kvermeer
 */
var bcrypt = require('bcrypt');
var pg = require('pg');

var UserCreationService = function() {}

/**
 * @param {string} name - username for user
 * @param {string} email - email for user
 * @param {string} password - password for logging into user account
 * @return {object} -
 *      {
 *          'success' => true,
 *          'errors' => [],
 *      }
 */
UserCreationService.prototype.createUser = function(username, email, password) {

    var passwordSalt = 10;
    var passwordHash = bcrypt.hashSync(password, passwordSalt);

    pg.connect(process.env.DATABASE_URL, function(err, client, done) {
        console.log(err);
        var queryStatement = 'INSERT INTO user (display_name, login, password_salt, password_hash) VALUES ($1, $2, $3, $4);'
        var values = [username, email, passwordSalt, passwordHash];
        client.query(queryStatement, values, function(err, result) {
             done();
             if (err) { console.error(err) }
             else { console.log(result) }
         });
    });
}

module.exports = UserCreationService;
