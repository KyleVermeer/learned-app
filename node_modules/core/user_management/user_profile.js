/**
 * Service for retrieving user profiles
 * @author kvermeer
 */

// Dependencies
var pg = require('pg');

var UserProfileService = function() {}

/**
 * Retrieves a user profile
 * @param {int} userId - id of the user to lookup
 * @param {function} callback - function to call when we have gather user profile information
 *                              the function should take an object (user profile)
 *                              and an error string as arguments
 * @return {void}
 */
UserProfileService.prototype.getUserProfile = function(userId, callback) {

    pg.connect(process.env.DATABASE_URL, function(err, client, done) {
        console.log(err);
        var queryStatement = 'SELECT * FROM "user" WHERE user_id = $1;';
        var values = [userId];
        client.query(queryStatement, values, function(err, result) {
             done();

             if (result && result.rowCount === 1) {
                 userProfileData = result.rows[0];
                 callback(userProfileData, null)
             }
             else {
                 console.error('Issue retrieving user profile for userId %1', userId);
                 console.error(err);
                 callback(null, err);
             }

         });
    });
}

module.exports = UserProfileService;
